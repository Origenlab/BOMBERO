---
/**
 * ─── BlogLayout ───
 * Layout for individual blog post pages.
 * Adds article-specific structured data and prose styling.
 */
import BaseLayout from "./BaseLayout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import { formatDate, readingTime } from "@utils/helpers";
import { articleJsonLd, breadcrumbJsonLd, canonicalURL } from "@utils/seo";

type Props = {
  title: string;
  description: string;
  date: Date;
  updatedDate?: Date;
  image?: string;
  author?: string;
  body: string;
  slug: string;
};

const { title, description, date, updatedDate, image, author, body, slug } = Astro.props;
const minutes = readingTime(body);

const jsonLd = [
  articleJsonLd({
    title,
    description,
    url: canonicalURL(`/blog/${slug}`),
    image,
    datePublished: date.toISOString(),
    dateModified: updatedDate?.toISOString(),
    author,
  }),
  breadcrumbJsonLd([
    { name: "Inicio", url: "/" },
    { name: "Blog", url: "/blog" },
    { name: title, url: `/blog/${slug}` },
  ]),
];
---

<BaseLayout
  title={title}
  description={description}
  image={image}
  type="article"
  publishedTime={date.toISOString()}
  modifiedTime={updatedDate?.toISOString()}
  author={author}
  jsonLd={jsonLd}
>
  <Header />

  <main id="main-content">
    <article class="blog-post section">
      <div class="container container--narrow">
        <!-- Post Header -->
        <header class="blog-post__header stack">
          <h1 class="blog-post__title">{title}</h1>
          <div class="blog-post__meta cluster">
            <time datetime={date.toISOString()}>{formatDate(date)}</time>
            <span aria-hidden="true">&middot;</span>
            <span>{minutes} min de lectura</span>
            {author && (
              <>
                <span aria-hidden="true">&middot;</span>
                <span>Por {author}</span>
              </>
            )}
          </div>
          {updatedDate && (
            <p class="blog-post__updated">
              Actualizado el <time datetime={updatedDate.toISOString()}>{formatDate(updatedDate)}</time>
            </p>
          )}
        </header>

        <!-- Post Image -->
        {image && (
          <img
            src={image}
            alt=""
            class="blog-post__hero-image"
            width="768"
            height="432"
            loading="eager"
          />
        )}

        <!-- Post Content (Markdown/MDX renders here) -->
        <div class="prose">
          <slot />
        </div>
      </div>
    </article>
  </main>

  <Footer />
</BaseLayout>

<style>
  .blog-post__header {
    margin-block-end: var(--space-2xl);
  }

  .blog-post__title {
    font-size: var(--text-4xl);
    line-height: 1.15;
  }

  .blog-post__meta {
    font-size: var(--text-sm);
    color: var(--color-text-light);
  }

  .blog-post__updated {
    font-size: var(--text-xs);
    color: var(--color-text-light);
    font-style: italic;
  }

  .blog-post__hero-image {
    width: 100%;
    aspect-ratio: 16 / 9;
    object-fit: cover;
    border-radius: var(--radius-md);
    margin-block-end: var(--space-2xl);
  }
</style>
