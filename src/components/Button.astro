---
/**
 * ─── Button Component ───
 * Botón reutilizable con múltiples variantes y tamaños.
 *
 * Props:
 * - variant: "primary" | "secondary" | "outline" | "ghost" | "danger" | "whatsapp"
 * - size: "sm" | "md" | "lg" | "xl"
 * - href: URL para enlace (convierte en <a>)
 * - type: "button" | "submit" | "reset" (solo para <button>)
 * - fullWidth: boolean
 * - disabled: boolean
 * - icon: "left" | "right" | "only" (posición del slot de icono)
 * - loading: boolean
 * - external: boolean (abre en nueva pestaña)
 */

interface Props {
  variant?: "primary" | "secondary" | "outline" | "ghost" | "danger" | "whatsapp";
  size?: "sm" | "md" | "lg" | "xl";
  href?: string;
  type?: "button" | "submit" | "reset";
  fullWidth?: boolean;
  disabled?: boolean;
  icon?: "left" | "right" | "only";
  loading?: boolean;
  external?: boolean;
  class?: string;
}

const {
  variant = "primary",
  size = "md",
  href,
  type = "button",
  fullWidth = false,
  disabled = false,
  icon,
  loading = false,
  external = false,
  class: className = "",
} = Astro.props;

const isLink = !!href;
const Tag = isLink ? "a" : "button";

const classes = [
  "btn",
  `btn--${variant}`,
  `btn--${size}`,
  fullWidth && "btn--full",
  disabled && "btn--disabled",
  loading && "btn--loading",
  icon === "only" && "btn--icon-only",
  className,
].filter(Boolean).join(" ");

const linkProps = isLink
  ? {
      href,
      ...(external && { target: "_blank", rel: "noopener noreferrer" }),
    }
  : {};

const buttonProps = !isLink
  ? {
      type,
      disabled: disabled || loading,
    }
  : {};
---

<Tag class={classes} {...linkProps} {...buttonProps}>
  {loading && (
    <span class="btn__spinner" aria-hidden="true">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
      </svg>
    </span>
  )}
  {icon === "left" && <span class="btn__icon btn__icon--left"><slot name="icon" /></span>}
  {icon !== "only" && <span class="btn__text"><slot /></span>}
  {icon === "only" && <span class="btn__icon"><slot name="icon" /></span>}
  {icon === "right" && <span class="btn__icon btn__icon--right"><slot name="icon" /></span>}
</Tag>

<style>
  /* ═══════════════════════════════════════════════════════════════════════
     BUTTON COMPONENT
     ═══════════════════════════════════════════════════════════════════════ */

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    font-family: inherit;
    font-weight: 600;
    text-decoration: none;
    border: none;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--transition-base);
    position: relative;
    overflow: hidden;
    white-space: nowrap;
  }

  .btn:focus-visible {
    outline: 2px solid var(--color-fire-500);
    outline-offset: 2px;
  }

  /* ═══ Size Variants ═══ */
  .btn--sm {
    padding: var(--space-2) var(--space-4);
    font-size: var(--text-xs);
    border-radius: var(--radius-md);
  }

  .btn--md {
    padding: var(--space-3) var(--space-5);
    font-size: var(--text-sm);
  }

  .btn--lg {
    padding: var(--space-4) var(--space-6);
    font-size: var(--text-base);
  }

  .btn--xl {
    padding: var(--space-5) var(--space-8);
    font-size: var(--text-lg);
    border-radius: var(--radius-xl);
  }

  /* ═══ Color Variants ═══ */

  /* Primary - Fire gradient */
  .btn--primary {
    background: var(--gradient-fire);
    color: white;
    box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
  }

  .btn--primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(220, 38, 38, 0.4);
  }

  .btn--primary:active {
    transform: translateY(0);
    box-shadow: 0 2px 10px rgba(220, 38, 38, 0.3);
  }

  /* Secondary - Dark */
  .btn--secondary {
    background: var(--color-smoke-800);
    color: white;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }

  .btn--secondary:hover {
    background: var(--color-smoke-700);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
  }

  .btn--secondary:active {
    transform: translateY(0);
    background: var(--color-smoke-900);
  }

  /* Outline */
  .btn--outline {
    background: transparent;
    color: var(--color-fire-600);
    border: 2px solid var(--color-fire-600);
  }

  .btn--outline:hover {
    background: var(--color-fire-600);
    color: white;
    transform: translateY(-2px);
  }

  .btn--outline:active {
    transform: translateY(0);
  }

  /* Ghost */
  .btn--ghost {
    background: transparent;
    color: var(--color-smoke-700);
  }

  .btn--ghost:hover {
    background: var(--color-smoke-100);
    color: var(--color-smoke-900);
  }

  .btn--ghost:active {
    background: var(--color-smoke-200);
  }

  /* Danger */
  .btn--danger {
    background: var(--color-fire-600);
    color: white;
  }

  .btn--danger:hover {
    background: var(--color-fire-700);
    transform: translateY(-2px);
  }

  /* WhatsApp */
  .btn--whatsapp {
    background: #25D366;
    color: white;
    box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
  }

  .btn--whatsapp:hover {
    background: #128C7E;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
  }

  .btn--whatsapp:active {
    transform: translateY(0);
  }

  /* ═══ States ═══ */
  .btn--full {
    width: 100%;
  }

  .btn--disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  .btn--loading {
    pointer-events: none;
  }

  .btn--loading .btn__text,
  .btn--loading .btn__icon {
    opacity: 0;
  }

  /* ═══ Icon Only ═══ */
  .btn--icon-only.btn--sm {
    width: 32px;
    height: 32px;
    padding: 0;
  }

  .btn--icon-only.btn--md {
    width: 40px;
    height: 40px;
    padding: 0;
  }

  .btn--icon-only.btn--lg {
    width: 48px;
    height: 48px;
    padding: 0;
  }

  .btn--icon-only.btn--xl {
    width: 56px;
    height: 56px;
    padding: 0;
  }

  /* ═══ Inner Elements ═══ */
  .btn__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .btn__icon--left {
    margin-right: var(--space-1);
  }

  .btn__icon--right {
    margin-left: var(--space-1);
  }

  .btn__text {
    display: inline-flex;
    align-items: center;
  }

  /* ═══ Loading Spinner ═══ */
  .btn__spinner {
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btn__spinner svg {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  /* ═══ Responsive ═══ */
  @media (max-width: 480px) {
    .btn--lg {
      padding: var(--space-3) var(--space-5);
      font-size: var(--text-sm);
    }

    .btn--xl {
      padding: var(--space-4) var(--space-6);
      font-size: var(--text-base);
    }
  }
</style>
