---
/**
 * ─── Breadcrumb Component ───
 * Migas de pan para navegación y SEO.
 * Genera automáticamente Schema.org BreadcrumbList.
 *
 * Props:
 * - items: Array de { label, href }
 * - separator: string (separador visual)
 * - variant: "default" | "minimal" | "dark"
 */
import { SITE } from "@data/site";
import JsonLd from "./JsonLd.astro";

export interface BreadcrumbItem {
  label: string;
  href: string;
}

interface Props {
  items: BreadcrumbItem[];
  separator?: string;
  variant?: "default" | "minimal" | "dark";
}

const {
  items,
  separator = "/",
  variant = "default",
} = Astro.props;

// Always include home as first item
const allItems: BreadcrumbItem[] = [
  { label: "Inicio", href: "/" },
  ...items,
];

// Generate BreadcrumbList Schema.org
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: allItems.map((item, index) => ({
    "@type": "ListItem",
    position: index + 1,
    name: item.label,
    item: `${SITE.url}${item.href}`,
  })),
};

const breadcrumbClasses = [
  "breadcrumb",
  `breadcrumb--${variant}`,
].join(" ");
---

<!-- Schema.org Breadcrumb -->
<JsonLd data={breadcrumbSchema} />

<nav class={breadcrumbClasses} aria-label="Migas de pan">
  <ol class="breadcrumb__list" itemscope itemtype="https://schema.org/BreadcrumbList">
    {allItems.map((item, index) => {
      const isLast = index === allItems.length - 1;
      return (
        <li
          class="breadcrumb__item"
          itemprop="itemListElement"
          itemscope
          itemtype="https://schema.org/ListItem"
        >
          {!isLast ? (
            <>
              <a
                href={item.href}
                class="breadcrumb__link"
                itemprop="item"
              >
                <span itemprop="name">{item.label}</span>
              </a>
              <span class="breadcrumb__separator" aria-hidden="true">{separator}</span>
            </>
          ) : (
            <span class="breadcrumb__current" itemprop="name" aria-current="page">
              {item.label}
            </span>
          )}
          <meta itemprop="position" content={String(index + 1)} />
        </li>
      );
    })}
  </ol>
</nav>

<style>
  /* ═══════════════════════════════════════════════════════════════════════
     BREADCRUMB COMPONENT
     ═══════════════════════════════════════════════════════════════════════ */

  .breadcrumb {
    padding: var(--space-4) 0;
  }

  .breadcrumb__list {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-2);
    list-style: none;
    padding: 0;
    margin: 0;
    font-size: var(--text-sm);
  }

  .breadcrumb__item {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
  }

  .breadcrumb__link {
    color: var(--color-smoke-500);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .breadcrumb__link:hover {
    color: var(--color-fire-600);
    text-decoration: underline;
  }

  .breadcrumb__separator {
    color: var(--color-smoke-400);
    font-size: var(--text-xs);
  }

  .breadcrumb__current {
    color: var(--color-smoke-800);
    font-weight: 500;
  }

  /* ═══ Variants ═══ */

  /* Minimal */
  .breadcrumb--minimal {
    padding: var(--space-2) 0;
  }

  .breadcrumb--minimal .breadcrumb__list {
    font-size: var(--text-xs);
  }

  /* Dark */
  .breadcrumb--dark .breadcrumb__link {
    color: var(--color-smoke-400);
  }

  .breadcrumb--dark .breadcrumb__link:hover {
    color: var(--color-fire-400);
  }

  .breadcrumb--dark .breadcrumb__separator {
    color: var(--color-smoke-600);
  }

  .breadcrumb--dark .breadcrumb__current {
    color: white;
  }

  /* ═══ Responsive ═══ */
  @media (max-width: 480px) {
    .breadcrumb__list {
      font-size: var(--text-xs);
    }

    /* Hide middle items on very small screens */
    .breadcrumb__item:not(:first-child):not(:last-child) {
      display: none;
    }

    /* Show ellipsis instead */
    .breadcrumb__item:first-child::after {
      content: "...";
      margin-left: var(--space-2);
      color: var(--color-smoke-400);
    }
  }
</style>
