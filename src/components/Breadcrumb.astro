---
/**
 * ─── Breadcrumb Component ───
 * Navegación contextual inmediatamente debajo del header.
 * Diseño oscuro con acento de fuego. Incluye JSON-LD BreadcrumbList para SEO.
 *
 * Props:
 * - items: Array de { label, href? }  (sin incluir "Inicio", se agrega automáticamente)
 *
 * Uso:
 * <Breadcrumb items={[
 *   { label: "Productos", href: "/productos" },
 *   { label: "Trajes de Bombero" },
 * ]} />
 */

import { SITE } from "@data/site";

interface BreadcrumbItem {
  label: string;
  href?: string;
}

interface Props {
  items: BreadcrumbItem[];
}

const { items } = Astro.props;

const allItems: BreadcrumbItem[] = [{ label: "Inicio", href: "/" }, ...items];

const breadcrumbJsonLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: allItems.map((item, index) => ({
    "@type": "ListItem",
    position: index + 1,
    name: item.label,
    ...(item.href ? { item: `${SITE.url}${item.href}` } : {}),
  })),
};
---

<script
  type="application/ld+json"
  set:html={JSON.stringify(breadcrumbJsonLd)}
/>

<nav class="breadcrumb" aria-label="Ruta de navegación">
  <div class="breadcrumb__track">
    <div class="container">
      <ol class="breadcrumb__list" itemscope itemtype="https://schema.org/BreadcrumbList">
        {allItems.map((item, index) => {
          const isLast = index === allItems.length - 1;
          return (
            <li
              class={["breadcrumb__item", isLast && "breadcrumb__item--current"].filter(Boolean).join(" ")}
              itemprop="itemListElement"
              itemscope
              itemtype="https://schema.org/ListItem"
            >
              {index === 0 && (
                <svg
                  class="breadcrumb__home-icon"
                  width="13"
                  height="13"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                  aria-hidden="true"
                >
                  <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                </svg>
              )}

              {isLast ? (
                <span itemprop="name" aria-current="page">
                  {item.label}
                </span>
              ) : (
                <a href={item.href} itemprop="item">
                  <span itemprop="name">{item.label}</span>
                </a>
              )}

              <meta itemprop="position" content={String(index + 1)} />

              {!isLast && (
                <svg
                  class="breadcrumb__sep"
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true"
                >
                  <polyline points="9 18 15 12 9 6" />
                </svg>
              )}
            </li>
          );
        })}
      </ol>
    </div>
  </div>
</nav>

<style>
  /* ── Contenedor principal ── */
  .breadcrumb {
    position: relative;
    background: var(--color-smoke-950);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    overflow: hidden;
  }

  /* Línea de fuego en la parte inferior */
  .breadcrumb::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--gradient-fire);
    opacity: 0.8;
  }

  /* Resplandor lateral sutil */
  .breadcrumb::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 300px;
    height: 100%;
    background: radial-gradient(
      ellipse at left center,
      rgba(220, 38, 38, 0.08) 0%,
      transparent 70%
    );
    pointer-events: none;
  }

  .breadcrumb__track {
    position: relative;
    z-index: 1;
    padding: 0.625rem 0;
  }

  /* ── Lista ── */
  .breadcrumb__list {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  /* ── Ítem ── */
  .breadcrumb__item {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-size: var(--text-xs);
    font-weight: 500;
    letter-spacing: 0.02em;
    white-space: nowrap;
  }

  /* Ícono de casa */
  .breadcrumb__home-icon {
    color: var(--color-ember-400);
    flex-shrink: 0;
    margin-right: 0.125rem;
  }

  /* Links intermedios */
  .breadcrumb__item a {
    color: var(--color-smoke-400);
    text-decoration: none;
    transition: color var(--transition-fast);
    padding: 0.25rem 0;
  }

  .breadcrumb__item a:hover {
    color: var(--color-smoke-100);
  }

  /* Separador › */
  .breadcrumb__sep {
    color: var(--color-smoke-700);
    flex-shrink: 0;
    margin: 0 0.125rem;
  }

  /* Página actual */
  .breadcrumb__item--current span {
    color: var(--color-fire-400);
    font-weight: 600;
  }

  /* ── Responsive ── */
  @media (max-width: 480px) {
    .breadcrumb__item:not(:first-child):not(:last-child):not(:nth-last-child(2)) {
      display: none;
    }

    .breadcrumb__item:not(:first-child):not(:last-child):not(:nth-last-child(2)) + .breadcrumb__item::before {
      content: "…";
      color: var(--color-smoke-600);
      margin-right: 0.375rem;
    }
  }
</style>
