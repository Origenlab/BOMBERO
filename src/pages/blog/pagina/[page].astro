---
/**
 * ─── Blog Paginated Pages ───
 * Páginas de paginación del blog (página 2 en adelante).
 * URL: /blog/pagina/[page]
 */
import PageLayout from "@layouts/PageLayout.astro";
import Breadcrumb from "@components/Breadcrumb.astro";
import SectionHeader from "@components/SectionHeader.astro";
import CTABanner from "@components/CTABanner.astro";
import Pagination from "@components/Pagination.astro";
import { cdnW } from "@utils/cdn";
import { getAllArticulos } from "@data/blog-articulos";

/* ── Configuración de paginación ── */
const ARTICLES_PER_PAGE = 6;

/* ── Obtener todos los artículos ── */
const allArticulos = getAllArticulos();
const totalPages = Math.ceil(allArticulos.length / ARTICLES_PER_PAGE);

/* ── Generar rutas estáticas ── */
export function getStaticPaths() {
  const articulos = getAllArticulos();
  const perPage = 6;
  const totalPages = Math.ceil(articulos.length / perPage);

  // Solo generar páginas 2 en adelante (página 1 es /blog)
  return Array.from({ length: totalPages - 1 }, (_, i) => ({
    params: { page: String(i + 2) },
  }));
}

const { page } = Astro.params;
const currentPage = parseInt(page as string, 10);

// Validar página
if (isNaN(currentPage) || currentPage < 2 || currentPage > totalPages) {
  return Astro.redirect("/blog");
}

/* ── Obtener artículos para esta página ── */
const startIndex = (currentPage - 1) * ARTICLES_PER_PAGE;
const endIndex = startIndex + ARTICLES_PER_PAGE;
const articulos = allArticulos.slice(startIndex, endIndex);

const categorias = [
  { label: "Normativas", count: 1, slug: "normativas" },
  { label: "Mantenimiento", count: 1, slug: "mantenimiento" },
  { label: "Técnicas", count: 1, slug: "tecnicas" },
  { label: "Industrial", count: 1, slug: "industrial" },
  { label: "Forestales", count: 1, slug: "forestales" },
  { label: "Equipo", count: 11, slug: "equipo" },
];

const breadcrumb = [
  { label: "Blog", href: "/blog" },
  { label: `Página ${currentPage}` },
];

const articulosCdn = articulos.map(a => ({ ...a, imagen: cdnW(a.imagen, 500) }));
---

<PageLayout
  title={`Blog BOMBERO.MX — Página ${currentPage} | Artículos para Bomberos`}
  description={`Página ${currentPage} del blog de BOMBERO.MX. Artículos técnicos sobre equipo para bomberos, normativas NFPA, técnicas de rescate y mantenimiento de EPP.`}
  keywords={["blog bomberos", "artículos NFPA", "técnicas rescate", "mantenimiento EPP", "brigadas industriales"]}
  canonical={`/blog/pagina/${currentPage}`}
>

  <Breadcrumb items={breadcrumb} />

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!-- HEADER SIMPLE                                                   -->
  <!-- ═══════════════════════════════════════════════════════════════ -->
  <section class="blog-page-header">
    <div class="container">
      <div class="blog-page-header__content">
        <span class="blog-page-header__badge">Blog · Página {currentPage}</span>
        <h1 class="blog-page-header__title">
          Artículos para
          <span class="blog-page-header__highlight">Bomberos</span>
        </h1>
        <p class="blog-page-header__desc">
          Continúa explorando nuestro contenido técnico profesional.
        </p>
      </div>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!-- LAYOUT PRINCIPAL — ARTÍCULOS + SIDEBAR                          -->
  <!-- ═══════════════════════════════════════════════════════════════ -->
  <div class="blog-index-layout">
    <div class="container blog-index-layout__inner">

      <!-- ─── COLUMNA PRINCIPAL ─── -->
      <main class="blog-index-main">

        <div class="blog-grid">
          {articulosCdn.map((articulo) => (
            <article class="blog-card">
              <a href={`/blog/${articulo.slug}`} class="blog-card__link">
                <div class="blog-card__img-wrap">
                  <img
                    src={articulo.imagen}
                    alt={articulo.titulo}
                    loading="lazy"
                    width="500"
                    height="280"
                    class="blog-card__img"
                  />
                  <span class="blog-card__badge">{articulo.categoria}</span>
                </div>
                <div class="blog-card__body">
                  <h2 class="blog-card__title">{articulo.titulo}</h2>
                  <p class="blog-card__excerpt">{articulo.excerpt}</p>
                  <div class="blog-card__tags">
                    {articulo.tags.slice(0, 3).map((tag) => (
                      <span class="blog-card__tag">{tag}</span>
                    ))}
                  </div>
                  <span class="blog-card__anchor">
                    {articulo.anchorKeyword}
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" aria-hidden="true">
                      <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                  </span>
                </div>
              </a>
            </article>
          ))}
        </div>

        <!-- Paginación -->
        <Pagination
          currentPage={currentPage}
          totalPages={totalPages}
          baseUrl="/blog"
        />

      </main>

      <!-- ─── SIDEBAR ─── -->
      <aside class="blog-index-sidebar">

        <!-- CTA COTIZAR -->
        <div class="sb-card sb-card--cta">
          <h3 class="sb-card__title">Catálogo de Productos</h3>
          <p class="sb-card__text">Equipo certificado NFPA listo para envío a toda la República.</p>
          <a href="/productos" class="sb-cta-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/></svg>
            Ver Productos
          </a>
          <div class="sb-card__contacts">
            <a href="https://wa.me/525520780102" target="_blank" rel="noopener noreferrer" class="sb-contact sb-contact--wa">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 0 1-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0 0 12.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 0 0 5.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 0 0-3.48-8.413z"/></svg>
              WhatsApp
            </a>
          </div>
        </div>

        <!-- CATEGORÍAS -->
        <div class="sb-card">
          <h3 class="sb-card__title sb-card__title--dark">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
            Categorías
          </h3>
          <ul class="sb-cats">
            {categorias.map((cat) => (
              <li class="sb-cat">
                <a href={`/blog/categoria/${cat.slug}`} class="sb-cat__link">
                  <span class="sb-cat__label">{cat.label}</span>
                  <span class="sb-cat__count">{cat.count}</span>
                </a>
              </li>
            ))}
          </ul>
        </div>

        <!-- PRODUCTOS DESTACADOS -->
        <div class="sb-card">
          <h3 class="sb-card__title sb-card__title--dark">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/></svg>
            Productos Destacados
          </h3>
          <ul class="sb-links">
            <li><a href="/productos/trajes-para-bomberos" class="sb-link">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
              Trajes Estructurales
            </a></li>
            <li><a href="/productos/cascos-para-bomberos" class="sb-link">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
              Cascos NFPA
            </a></li>
            <li><a href="/productos/capuchas-para-bomberos" class="sb-link">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
              Capuchas NFPA
            </a></li>
            <li><a href="/productos/guantes-para-bomberos" class="sb-link">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
              Guantes Estructurales
            </a></li>
            <li><a href="/productos/botas-para-bomberos" class="sb-link">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
              Botas de Cuero
            </a></li>
          </ul>
          <a href="/productos" class="sb-see-all">Ver catálogo completo →</a>
        </div>

        <!-- DIRECTORIO -->
        <div class="sb-card">
          <h3 class="sb-card__title sb-card__title--dark">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
            Directorio de Bomberos
          </h3>
          <ul class="sb-links">
            <li><a href="/directorio/ciudad-de-mexico" class="sb-link">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
              Ciudad de México
            </a></li>
            <li><a href="/directorio/jalisco" class="sb-link">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
              Jalisco
            </a></li>
            <li><a href="/directorio/nuevo-leon" class="sb-link">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
              Nuevo León
            </a></li>
            <li><a href="/directorio/veracruz" class="sb-link">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
              Veracruz
            </a></li>
          </ul>
          <a href="/directorio" class="sb-see-all">Ver directorio completo →</a>
        </div>

      </aside>
    </div>
  </div>

  <CTABanner
    title="Explora Nuestro Catálogo Completo"
    desc="Más de 500 productos certificados NFPA listos para envío inmediato a toda la República."
    btnText="Ver Catálogo"
    btnHref="/productos"
  />

</PageLayout>

<style>
  /* ══════════════════════════════════════════════════════════════════════
     PAGE HEADER (versión simplificada para páginas internas)
     ══════════════════════════════════════════════════════════════════════ */
  .blog-page-header {
    background: var(--color-smoke-950);
    padding: var(--space-12) 0;
    position: relative;
    overflow: hidden;
  }

  .blog-page-header::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse 60% 40% at 50% 0%, rgba(220, 38, 38, 0.12), transparent),
      radial-gradient(ellipse 40% 30% at 80% 80%, rgba(249, 115, 22, 0.08), transparent);
    pointer-events: none;
  }

  .blog-page-header__content {
    position: relative;
    max-width: 640px;
  }

  .blog-page-header__badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    background: rgba(220, 38, 38, 0.15);
    border: 1px solid rgba(220, 38, 38, 0.3);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-fire-400);
    margin-bottom: var(--space-4);
  }

  .blog-page-header__title {
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 800;
    line-height: var(--leading-tight);
    color: white;
    margin: 0 0 var(--space-4);
  }

  .blog-page-header__highlight {
    background: var(--gradient-fire);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .blog-page-header__desc {
    font-size: var(--text-lg);
    color: var(--color-smoke-300);
    margin: 0;
    line-height: var(--leading-relaxed);
  }

  /* ══════════════════════════════════════════════════════════════════════
     LAYOUT PRINCIPAL
     ══════════════════════════════════════════════════════════════════════ */
  .blog-index-layout {
    background: var(--color-smoke-50);
    padding: var(--space-12) 0 var(--space-16);
  }

  .blog-index-layout__inner {
    display: grid;
    grid-template-columns: minmax(0, 1fr) 340px;
    gap: var(--space-10);
    align-items: start;
  }

  .blog-index-main {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
  }

  /* ══════════════════════════════════════════════════════════════════════
     GRID DE ARTÍCULOS
     ══════════════════════════════════════════════════════════════════════ */
  .blog-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-6);
  }

  .blog-card {
    background: white;
    border-radius: var(--radius-2xl);
    overflow: hidden;
    border: 1px solid var(--color-smoke-100);
  }

  .blog-card__link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .blog-card__img-wrap {
    position: relative;
    aspect-ratio: 16/9;
    overflow: hidden;
  }

  .blog-card__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .blog-card__badge {
    position: absolute;
    top: var(--space-3);
    left: var(--space-3);
    background: var(--color-fire-600);
    color: white;
    font-size: var(--text-xs);
    font-weight: 700;
    padding: 4px 10px;
    border-radius: var(--radius-full);
  }

  .blog-card__body {
    padding: var(--space-5);
  }

  .blog-card__title {
    font-size: var(--text-lg);
    font-weight: 800;
    color: var(--color-smoke-900);
    margin: 0 0 var(--space-2);
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .blog-card__excerpt {
    font-size: var(--text-sm);
    color: var(--color-smoke-600);
    margin: 0 0 var(--space-3);
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .blog-card__tags {
    display: flex;
    gap: var(--space-2);
    flex-wrap: wrap;
    margin-bottom: var(--space-3);
  }

  .blog-card__tag {
    background: var(--color-smoke-100);
    color: var(--color-smoke-600);
    font-size: 10px;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: var(--radius-full);
  }

  .blog-card__anchor {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--color-fire-600);
    border-bottom: 1px solid var(--color-fire-300);
    padding-bottom: 2px;
  }

  .blog-card__anchor svg {
    flex-shrink: 0;
  }

  /* ══════════════════════════════════════════════════════════════════════
     SIDEBAR
     ══════════════════════════════════════════════════════════════════════ */
  .blog-index-sidebar {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    position: sticky;
    top: 90px;
  }

  .sb-card {
    background: white;
    border: 1px solid var(--color-smoke-100);
    border-radius: var(--radius-2xl);
    padding: var(--space-5);
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
  }

  .sb-card--cta {
    background: linear-gradient(135deg, var(--color-fire-600) 0%, var(--color-ember-600) 100%);
    border-color: transparent;
  }

  .sb-card__title {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-base);
    font-weight: 800;
    color: white;
    margin: 0 0 var(--space-2);
    line-height: 1.3;
  }

  .sb-card__title--dark { color: var(--color-smoke-800); }
  .sb-card__title--dark svg { vertical-align: middle; color: var(--color-fire-500); }

  .sb-card__text {
    font-size: var(--text-sm);
    color: rgba(255,255,255,0.85);
    margin: 0 0 var(--space-4);
    line-height: 1.5;
  }

  .sb-cta-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    width: 100%;
    padding: var(--space-3) var(--space-4);
    background: white;
    color: var(--color-fire-700);
    font-size: var(--text-sm);
    font-weight: 800;
    text-decoration: none;
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-4);
  }

  .sb-card__contacts {
    display: flex;
    gap: var(--space-3);
    justify-content: center;
  }

  .sb-contact {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--text-xs);
    font-weight: 600;
    color: rgba(255,255,255,0.75);
    text-decoration: none;
  }

  .sb-contact--wa { color: #86efac; }

  .sb-cats {
    list-style: none;
    padding: 0;
    margin: var(--space-3) 0 0;
    display: flex;
    flex-direction: column;
    gap: 0;
  }

  .sb-cat { display: block; }

  .sb-cat__link {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-2) var(--space-2);
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-smoke-700);
    text-decoration: none;
    border-radius: var(--radius-md);
  }

  .sb-cat__count {
    font-size: var(--text-xs);
    font-weight: 700;
    color: var(--color-smoke-400);
    background: var(--color-smoke-100);
    padding: 2px 8px;
    border-radius: var(--radius-full);
  }

  .sb-links {
    list-style: none;
    padding: 0;
    margin: var(--space-3) 0 var(--space-3);
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .sb-link {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-xs);
    font-weight: 500;
    color: var(--color-smoke-700);
    text-decoration: none;
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-md);
  }

  .sb-link svg { color: var(--color-smoke-400); flex-shrink: 0; }

  .sb-see-all {
    display: block;
    font-size: var(--text-xs);
    font-weight: 700;
    color: var(--color-fire-600);
    text-decoration: none;
    text-align: right;
    padding-top: var(--space-1);
    border-top: 1px solid var(--color-smoke-100);
  }

  /* ══════════════════════════════════════════════════════════════════════
     RESPONSIVE
     ══════════════════════════════════════════════════════════════════════ */
  @media (max-width: 1024px) {
    .blog-index-layout__inner {
      grid-template-columns: 1fr;
    }

    .blog-index-sidebar {
      position: static;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-4);
    }

    .blog-index-sidebar .sb-card--cta {
      grid-column: span 2;
    }
  }

  @media (max-width: 768px) {
    .blog-page-header {
      padding: var(--space-8) 0;
    }

    .blog-page-header__title {
      font-size: clamp(1.75rem, 5vw, 2.5rem);
    }

    .blog-grid {
      grid-template-columns: 1fr;
    }

    .blog-index-sidebar {
      grid-template-columns: 1fr;
    }

    .blog-index-sidebar .sb-card--cta {
      grid-column: span 1;
    }
  }
</style>
